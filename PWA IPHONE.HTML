<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Forex & Commodity Position Size Calculator</title>
<!-- PWA / iPhone full screen setup -->
<link rel="apple-touch-icon" href="icon.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<style>
body{font-family:Arial,sans-serif;background:#f4f6f9;padding:20px;}
.card{background:#fff;padding:20px;border-radius:10px;max-width:700px;margin:auto;box-shadow:0 5px 20px rgba(0,0,0,0.1);}
label{display:block;margin-top:10px;}
input,select{width:100%;padding:8px;margin-top:4px;border-radius:6px;border:1px solid #ccc;}
button{padding:10px 15px;border:none;border-radius:6px;background:#0ea5a4;color:#fff;cursor:pointer;margin-top:12px;}
.result{margin-top:15px;padding:10px;background:#f0f8ff;border-radius:6px;}
</style>
</head>
<body>
<div class="card">
<h2>Position Size Calculator (Forex & Commodities)</h2>
<label>Account Balance (USD)</label>
<input id="balance" type="number" value="5050">
<label>Risk Type</label>
<input type="radio" name="riskType" value="amount" checked> Amount
<input type="radio" name="riskType" value="percent"> Percent %
<label>Risk Amount (USD)</label>
<input id="riskAmount" type="number" value="50">
<label>Risk Percent (%)</label>
<input id="riskPercent" type="number" value="1" disabled>
<label>Stop Loss (pips/points)</label>
<input id="stopLoss" type="number" value="41">
<label>Instrument / Pair</label>
<select id="pair">
<option value="CADJPY">CADJPY</option>
<option value="USDJPY">USDJPY</option>
<option value="AUDJPY">AUDJPY</option>
<option value="USDCAD">USDCAD</option>
<option value="EURUSD">EURUSD</option>
<option value="GBPUSD">GBPUSD</option>
<option value="USDCHF">USDCHF</option>
<option value="AUDUSD">AUDUSD</option>
<option value="XAUUSD">Gold (XAUUSD)</option>
<option value="XAGUSD">Silver (XAGUSD)</option>
<option value="Custom">Custom Pair</option>
</select>
<div id="customPairRow" style="display:none;">
<label>Custom Pair Symbol</label>
<input id="customPair" type="text" placeholder="e.g. NZDUSD">
<label>Custom Pair USD Rate</label>
<input id="customRate" type="number" step="0.0001" placeholder="Enter USD rate manually">
</div>
<div id="usdJpyRow">
<label>USDJPY Rate (manual, only for JPY pairs)</label>
<input id="usdJpy" type="number" step="0.0001" value="140.00">
</div>
<button onclick="calculate()">Calculate</button>
<div class="result" id="result"></div>
</div>
<script>
function toggleRisk(){
  const type = document.querySelector('input[name="riskType"]:checked').value;
  document.getElementById('riskAmount').disabled = (type!=='amount');
  document.getElementById('riskPercent').disabled = (type!=='percent');
}

document.querySelectorAll('input[name="riskType"]').forEach(el => el.addEventListener('change', toggleRisk));

document.getElementById('pair').addEventListener('change', ()=>{
  const pair = document.getElementById('pair').value;
  document.getElementById('customPairRow').style.display = pair==='Custom'?'block':'none';
  if(['CADJPY','USDJPY','AUDJPY'].includes(pair)){
    document.getElementById('usdJpyRow').style.display='block';
  } else {
    document.getElementById('usdJpyRow').style.display='none';
  }
});

function calculate(){
  const balance = parseFloat(document.getElementById('balance').value);
  const riskType = document.querySelector('input[name="riskType"]:checked').value;
  let riskUSD = riskType==='amount'?parseFloat(document.getElementById('riskAmount').value):balance*parseFloat(document.getElementById('riskPercent').value)/100;
  const stopLoss = parseFloat(document.getElementById('stopLoss').value);
  const pair = document.getElementById('pair').value;
  const usdJpyRate = parseFloat(document.getElementById('usdJpy').value) || 1;
  const lotStep = 0.01;
  const lotStandard = 100000;
  let pipValue=0, base='Units';

  if(['CADJPY','USDJPY','AUDJPY'].includes(pair)){
    pipValue = 0.01*lotStandard / usdJpyRate;
    base = pair.slice(0,3);
  } else if(['USDCAD','EURUSD','GBPUSD','USDCHF','AUDUSD'].includes(pair)){
    pipValue = 0.0001*lotStandard;
    base = pair.slice(0,3);
  } else if(['XAUUSD'].includes(pair)){
    pipValue = 0.1 * 100;
    base = 'Gold';
  } else if(['XAGUSD'].includes(pair)){
    pipValue = 0.01 * 5000;
    base = 'Silver';
  } else {
    let rate = parseFloat(document.getElementById('customRate').value)||1;
    pipValue = 0.0001*lotStandard*rate;
    base = document.getElementById('customPair').value || 'Custom';
  }

  const lotsExact = riskUSD / (stopLoss * pipValue);
  const safeLots = Math.floor(lotsExact/lotStep)*lotStep;
  const units = safeLots*lotStandard;
  const potentialLoss = safeLots*pipValue*stopLoss;

  document.getElementById('result').innerHTML =
    `Exact Lots: ${lotsExact.toFixed(4)}<br>
     Safe Lots: ${safeLots.toFixed(2)}<br>
     Units: ${Math.round(units).toLocaleString()} ${base}<br>
     Potential Loss: $${potentialLoss.toFixed(2)}`;
}
</script>
</body>
</html>
